
const express = require('express');
const router = express.Router();
const Post = require('../models/post');

router.get('', async (req, res) => {
  try {
    const perPage = 10;
    const page = parseInt(req.query.page) || 1;

    const data = await Post.aggregate([{ $sort: { createdAt: -1 } }])
      .skip(perPage * (page - 1))
      .limit(perPage)
      .exec();

    const count = await Post.countDocuments();
    const nextPage = page + 1;
    const hasNextPage = nextPage <= Math.ceil(count / perPage);

    console.log({ current: page, nextPage, hasNextPage, total: count });

    res.render('index', {
      data,
      current: page,
      nextPage: hasNextPage ? nextPage : null
    });
  } catch (error) {
    console.log(error);
  }
});



async function insertPost() {
  const count = await Post.countDocuments();
  if (count === 0) {
    await Post.insertMany([
      {
        title: "Hansel And Gretel",
        Body: "Witches used to cause trouble in village so Hansel And Gretel killed 'em "
      },
      {
        title: "Hansel And Gretel",
        Body: "Witches used to cause trouble in village so Hansel And Gretel killed 'em "
      },
      {
        title: "Hansel And Gretel",
        Body: "Witches used to cause trouble in village so Hansel And Gretel killed 'em "
      },
      {
        title: "Hansel And Gretel",
        Body: "Witches used to cause trouble in village so Hansel And Gretel killed 'em "
      },
      {
        title: "Hansel And Gretel",
        Body: "Witches used to cause trouble in village so Hansel And Gretel killed 'em "
      },
      {
        title: "Hansel And Gretel",
        Body: "Witches used to cause trouble in village so Hansel And Gretel killed 'em "
      },
      {
        title: "Hansel And Gretel",
        Body: "Witches used to cause trouble in village so Hansel And Gretel killed 'em "
      },
      {
        title: "Hansel And Gretel",
        Body: "Witches used to cause trouble in village so Hansel And Gretel killed 'em "
      },
      {
        title: "Hansel And Gretel",
        Body: "Witches used to cause trouble in village so Hansel And Gretel killed 'em "
      },
      {
        title: "Hansel And Gretel",
        Body: "Witches used to cause trouble in village so Hansel And Gretel killed 'em "
      }
    ]);
    console.log('Posts inserted');
  } else {
    console.log('Posts already exist, skipping insertion');
  }
}


// insertPost();

router.get('/about',(req,res)=>{

res.render('about');

})


module.exports = router;

